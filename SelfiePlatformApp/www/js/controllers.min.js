angular.module('starter.controllers',[]).controller('DashCtrl',function($scope,Api,$ionicPopover,$ionicLoading,$timeout,$ionicModal,$window,$ionicPopup){console.info("DashCtrl");$scope.delete=function(password){Api.deleteAll(password).then(function(response){console.log("> DeleteAll\n",response)})};$scope.takePhoto=function(){Api.takePhoto().then(function(response){$scope.msg=response.msg+" \n "+response.response;if(response.success==!0){$scope.photoUrl=response.image;$timeout(function(){$scope.openPhoto();$ionicLoading.hide()},1000)}else{$scope.photoUrl=undefined;$timeout(function(){$ionicLoading.hide()},1000);var alertPopup=$ionicPopup.alert({title:'ERRORE, <u>RITENTA</u>!',template:$scope.msg,okType:'button-assertive',okText:'Riprova'});alertPopup.then(function(res){console.info("alertPopup:",res);window.location.reload()})}
console.log("> Take Photo:\n",response)})};$scope.saveSettings=function(selfieSec,numSec){$ionicLoading.show({template:'<b class="caricamento"><br><br><br>All saved, wait for page\'s regresh!</b>'});if(parseInt(selfieSec)>parseInt(numSec)){window.localStorage.numSec=parseInt(numSec);window.localStorage.selfieSec=parseInt(selfieSec);console.log("Selfie Sec > "+window.localStorage.selfieSec,"Num Sec to Post > "+window.localStorage.numSec)}else{alert("Il numero di secondi da attendere per scattare un selfie deve essere maggiore del \n secondo esatto in cui viene inviata la richiesta al server.")}
$timeout(function(){$ionicLoading.hide();window.location.reload()},1000)};$ionicPopover.fromTemplateUrl('templates/popover/settings.html',{scope:$scope}).then(function(popover){$scope.popover=popover});$scope.openPopover=function($event){$scope.popover.show($event)};$scope.closePopover=function(){$scope.popover.hide()};$scope.$on('$destroy',function(){$scope.popover.remove()});$scope.$on('popover.hidden',function(){});$scope.$on('popover.removed',function(){});$scope.counter=parseInt(window.localStorage.selfieSec)||parseInt(5);$scope.selfieSec=parseInt(window.localStorage.selfieSec)||parseInt(5);$scope.numSec=parseInt(window.localStorage.numSec)||parseInt(1);var mytimeout=null;$scope.onTimeout=function(){if($scope.counter===0){$timeout(function(){$ionicLoading.show({template:'<ion-spinner icon="lines"></ion-spinner>'});$scope.closeModal();$scope.$broadcast('timer-stopped',0);$timeout.cancel(mytimeout);return},2000)}
if($scope.counter===$scope.numSec){$scope.takePhoto()}$scope.counter--;console.info($scope.counter);mytimeout=$timeout($scope.onTimeout,1000)};$scope.startTimer=function(){mytimeout=$timeout($scope.onTimeout,1000)};$scope.$on('timer-stopped',function(event,tempoRimanente){if(tempoRimanente===0){console.log('finitooooo');$scope.counter="â˜»";$timeout(function(){$scope.counter=parseInt(window.localStorage.selfieSec)||parseInt(10)},2000)}});$ionicModal.fromTemplateUrl('templates/modal/countdown.html',{id:1,scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.modal1=modal});$ionicModal.fromTemplateUrl('templates/modal/photoTaken.html',{id:2,scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.modal2=modal});$scope.start=function(){console.log("START");$scope.modal1.show();$scope.startTimer()};$scope.closeModal=function(){$scope.modal1.hide()};$scope.openPhoto=function(){$scope.modal1.remove();$scope.modal2.show()};$scope.closePhoto=function(){$scope.modal2.remove();$timeout(function(){$window.location.reload()},500)};$scope.stopCounter=function(){if(($scope.counter<$scope.selfieSec)&&($scope.counter>$scope.numSec)){$scope.modal1.remove();$scope.$broadcast('timer-stopped',0);$timeout.cancel(mytimeout);window.location.reload(!0)}}}).controller('PhotosCtrl',function($scope,Api,$ionicModal){console.log("Photos");Api.getPhotos().then(function(response){$scope.photos=response.reverse();console.log("> Get Photos:\n",response)}); $scope.doRefresh=function(){Api.getPhotos().then(function(response){$scope.photos=response.reverse();console.log("> Get NEW Photos:\n",response);$scope.$broadcast('scroll.refreshComplete')})};$ionicModal.fromTemplateUrl('templates/modal/openPhoto.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.modal=modal});$scope.apriModal=function(url){$scope.photoUrl=url;$scope.modal.show()};$scope.chiudiModal=function(){$scope.modal.hide()};$scope.$on('$destroy',function(){$scope.modal.remove()})})
